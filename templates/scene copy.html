<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>场景页面</title>
    <style>
        .map-container {
            display: grid;
            grid-template-areas:
                ". north ."
                "west center east"
                ". south .";
            gap: 10px;
            justify-content: start;
            text-align: center;
            margin-left: 20px;
        }
        .direction-link {
            text-decoration: none;
            color: #0066cc;
        }
        .direction-link:hover {
            text-decoration: underline;
            color: #003366;
        }
        .north { grid-area: north; }
        .south { grid-area: south; }
        .east { grid-area: east; }
        .west { grid-area: west; }
        .center { 
            grid-area: center;
            padding: 0 20px;
        }
    </style>
</head>
<body>
    {% if player.last_chat_message %}
        <div style="background-color: #f0f0f0; padding: 10px; margin-bottom: 20px;">
            【私聊】{{ player.last_chat_message.sender }}对你说：{{ player.last_chat_message.content }}
        </div>
    {% endif %}
    <h3>{{ location.area_name }} - {{ location.name }}</h3>
    <a href="{{ url_for('shop') }}">进入商城</a>
    <div>
        <h3>地图</h3>
        <div class="map-container">
            {% if location.north_exit %}
            <div class="north">
                <a class="direction-link" href="{{ url_for('move', direction='north') }}">
                    北 - {{ locations[location.north_exit].name }}
                    <small>({{ locations[location.north_exit].area_name }})</small>
                </a>
            </div>
            {% endif %}
        
            {% if location.south_exit %}
            <div class="south">
                <a class="direction-link" href="{{ url_for('move', direction='south') }}">
                    南 - {{ locations[location.south_exit].name }}
                    <small>({{ locations[location.south_exit].area_name }})</small>
                </a>
            </div>
            {% endif %}
        
            {% if location.east_exit %}
            <div class="east">
                <a class="direction-link" href="{{ url_for('move', direction='east') }}">
                    东 - {{ locations[location.east_exit].name }}
                    <small>({{ locations[location.east_exit].area_name }})</small>
                </a>
            </div>
            {% endif %}
        
            {% if location.west_exit %}
            <div class="west">
                <a class="direction-link" href="{{ url_for('move', direction='west') }}">
                    西 - {{ locations[location.west_exit].name }}
                    <small>({{ locations[location.west_exit].area_name }})</small>
                </a>
            </div>
            {% endif %}
        
            <div class="center">
                [{{ location.name }}]
            </div>
        </div>        
    </div>
    <div>
        <h3>NPC/怪物</h3>
        {% if monster %}
            {% if monster.killable %}
                <p>名字: <a href="{{ url_for('battle') }}">{{ monster.name }}</a></p>
                <p>等级: {{ monster.level }}</p>
                <p>生命值: {{ monster.health }}/{{ monster.max_health }}</p>
            {% else %}
                <p>{{ monster.name }}: {{ monster.description }}</p>
                {% if monster.monster_id == "monster_village_trainer" %}
                    <a href="{{ url_for('skill_hall') }}">学习技能</a>
                {% endif %}
            {% endif %}
        {% else %}
            <p>这里暂时没有怪物。</p>
        {% endif %}
    </div>    
    <div>
        <h3>地面物品</h3>
        {% if location.ground_items %}
            {% for item_id in location.ground_items %}
                <a href="{{ url_for('pickup_item', item_id=item_id) }}">
                    {{ Item.load_items()[item_id].name }}
                </a>
            {% endfor %}
        {% else %}
            <p>地上什么都没有。</p>
        {% endif %}
    </div>      
    <div>
        <h3>玩家</h3>
        <p>生命值: {{ player.health }}/{{ player.max_health }}</p>
        <a href="{{ url_for('character') }}">角色</a>
        <a href="{{ url_for('inventory') }}">背包</a>
        <a href="{{ url_for('chat') }}">聊天</a>
    </div>
    <div>
        <h3>当前在线玩家</h3>
        <ul>
        {% for other_player in other_players %}
            <li><a href="{{ url_for('view_player', username=other_player.username) }}">{{ other_player.name }}</a></li>
        {% endfor %}
        </ul>
    </div>    
    <div style="margin-top: 20px;">
        <a href="{{ url_for('logout') }}">退出游戏</a>
    </div>
</body>
</html>
